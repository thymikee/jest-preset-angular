"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["4452"],{2705:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>o,toc:()=>d,default:()=>m,metadata:()=>s,assets:()=>c,contentTitle:()=>a});var s=JSON.parse('{"id":"guides/snapshot-testing","title":"Snapshot testing","description":"jest-preset-angular provides several snapshot serializers to generate clearer and more human-readable snapshot.","source":"@site/versioned_docs/version-14.x/guides/snapshot-testing.md","sourceDirName":"guides","slug":"/guides/snapshot-testing","permalink":"/jest-preset-angular/pr-preview/pr-3521/docs/14.x/guides/snapshot-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/thymikee/jest-preset-angular/edit/main/website/versioned_docs/version-14.x/guides/snapshot-testing.md","tags":[],"version":"14.x","lastUpdatedBy":"renovate[bot]","lastUpdatedAt":1764856534000,"frontMatter":{"id":"snapshot-testing","title":"Snapshot testing"},"sidebar":"docs","previous":{"title":"JSDOM version","permalink":"/jest-preset-angular/pr-preview/pr-3521/docs/14.x/guides/jsdom-version"},"next":{"title":"Using with Babel","permalink":"/jest-preset-angular/pr-preview/pr-3521/docs/14.x/guides/using-with-babel"}}'),i=t(4848),r=t(4429),l=t(5785);let o={id:"snapshot-testing",title:"Snapshot testing"},a,c={},d=[{value:"Snapshot serializers",id:"snapshot-serializers",level:2},{value:"Remove html comments (<code>html-comment</code>)",id:"remove-html-comments-html-comment",level:3},{value:"Examples:",id:"examples",level:4},{value:"Display component HTML (<code>ng-snapshot</code>)",id:"display-component-html-ng-snapshot",level:3},{value:"Parameters",id:"parameters",level:4},{value:"Examples:",id:"examples-1",level:4},{value:"With options",id:"with-options",level:4},{value:"Remove Angular attributes (<code>no-ng-attributes</code>)",id:"remove-angular-attributes-no-ng-attributes",level:3},{value:"Examples:",id:"examples-2",level:4}];function p(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"jest-preset-angular"})," provides several snapshot serializers to generate clearer and more human-readable snapshot."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"BY DEFAULT"}),", the ",(0,i.jsx)(n.a,{href:"/jest-preset-angular/pr-preview/pr-3521/docs/14.x/getting-started/presets",children:"preset"})," provides all of the snapshot serializers below."]})}),"\n",(0,i.jsx)(n.h2,{id:"snapshot-serializers",children:"Snapshot serializers"}),"\n","\n",(0,i.jsx)(l.A,{toc:d.slice(1)}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"remove-html-comments-html-comment",children:["Remove html comments (",(0,i.jsx)(n.code,{children:"html-comment"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"Allow removing all the comments in the component HTML in snapshot."}),"\n",(0,i.jsx)(n.h4,{id:"examples",children:"Examples:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In Jest config file"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest';\n\nexport default {\n  //[...]\n  snapshotSerializers: ['jest-preset-angular/build/serializers/html-comment'],\n  //[...]\n} satisfies Config;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Or in setup test environment file"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest';\n\nexport default {\n  //[...]\n  setupFilesAfterEnv: ['./setup-jest.ts'],\n  //[...]\n} satisfies Config;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="setup-jest.ts"',children:"import removeHtmlCommentsSerializer from 'jest-preset-angular/build/serializers/html-comment';\n\nexpect.addSnapshotSerializer(removeHtmlCommentsSerializer);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Or in individual test files"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="foo.component.spec.ts"',children:"import removeHtmlCommentsSerializer from 'jest-preset-angular/build/serializers/html-comment';\n\nexpect.addSnapshotSerializer(removeHtmlCommentsSerializer);\n\nit('should work', () => {\n  //[...]\n});\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"display-component-html-ng-snapshot",children:["Display component HTML (",(0,i.jsx)(n.code,{children:"ng-snapshot"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"Allow displaying component HTML with data in snapshot."}),"\n",(0,i.jsx)(n.h4,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["options(",(0,i.jsx)(n.strong,{children:"optional"}),"):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"omitAllCompAttrs: remove all component DOM attributes"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"type NgSnapshotOptions = {\n  omitAllCompAttrs?: boolean;\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"examples-1",children:"Examples:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In Jest config"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest';\n\nexport default {\n  //[...]\n  snapshotSerializers: ['jest-preset-angular/build/serializers/ng-snapshot'],\n  //[...]\n} satisfies Config;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Or in setup test environment file"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="setup-jest.ts"',children:"import componentSnapshotSerializer from 'jest-preset-angular/build/serializers/ng-snapshot';\n\nexpect.addSnapshotSerializer(componentSnapshotSerializer);\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest';\n\nexport default {\n  //[...]\n  setupFilesAfterEnv: ['./setup-jest.ts'],\n  //[...]\n} satisfies Config;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Or in individual test files"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="foo.component.spec.ts"',children:"import componentSnapshotSerializer from 'jest-preset-angular/build/serializers/ng-snapshot';\n\nexpect.addSnapshotSerializer(componentSnapshotSerializer);\n\nit('should work', () => {\n  //[...]\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"with-options",children:"With options"}),"\n",(0,i.jsxs)(n.admonition,{title:"Effective priority",type:"info",children:[(0,i.jsx)(n.p,{children:"The configured serializers will have affect in this order:"}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Jest config"})," -> ",(0,i.jsx)(n.code,{children:"setup files"})," -> ",(0,i.jsx)(n.code,{children:"test files"})]}),(0,i.jsx)(n.p,{children:"The later the higher priority. This means that with the same serializer, the later one will override the configuration\nof the previous one in the chain."})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In setup files:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="setup-jest.ts"',children:"import componentSnapshotSerializer from 'jest-preset-angular/build/serializers/ng-snapshot';\n\nexpect.addSnapshotSerializer({\n  print: (val, print, indent, options, colors) =>\n    componentSnapshotSerializer.print(\n      val,\n      print,\n      indent,\n      {\n        ...options,\n        omitAllCompAttrs: true,\n      },\n      colors,\n    ),\n  test: componentSnapshotSerializer.test,\n});\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest';\n\nexport default {\n  //[...]\n  setupFilesAfterEnv: ['./setup-jest.ts'],\n  //[...]\n} satisfies Config;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"or in individual test files:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="foo.component.spec.ts"',children:"import componentSnapshotSerializer from 'jest-preset-angular/build/serializers/ng-snapshot';\n\nexpect.addSnapshotSerializer({\n  print: (val, print, indent, options, colors) =>\n    componentSnapshotSerializer.print(\n      val,\n      print,\n      indent,\n      {\n        ...options,\n        omitAllCompAttrs: true,\n      },\n      colors,\n    ),\n  test: componentSnapshotSerializer.test,\n});\n\nit('should work', () => {\n  //[...]\n});\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"remove-angular-attributes-no-ng-attributes",children:["Remove Angular attributes (",(0,i.jsx)(n.code,{children:"no-ng-attributes"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Allow removing attributes generated by Angular fixture, like ",(0,i.jsx)(n.code,{children:"ng-reflect-*"}),", ",(0,i.jsx)(n.code,{children:'ng-version="*"'}),", ",(0,i.jsx)(n.code,{children:"_ngcontent-c*"})," etc., from component snapshot"]}),"\n",(0,i.jsx)(n.h4,{id:"examples-2",children:"Examples:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In Jest config"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest';\n\nexport default {\n  //[...]\n  snapshotSerializers: ['jest-preset-angular/build/serializers/no-ng-attributes'],\n  //[...]\n} satisfies Config;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Or in setup test environment file"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="setup-jest.ts"',children:"import removeNgAttributes from 'jest-preset-angular/build/serializers/no-ng-attributes';\n\nexpect.addSnapshotSerializer(removeNgAttributes);\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest';\n\nexport default {\n  //[...]\n  setupFilesAfterEnv: ['./setup-jest.ts'],\n  //[...]\n} satisfies Config;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Or in individual test files"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="foo.component.spec.ts"',children:"import removeNgAttributes from 'jest-preset-angular/build/serializers/no-ng-attributes';\n\nexpect.addSnapshotSerializer(removeNgAttributes);\n\nit('should work', () => {\n  //[...]\n});\n"})})]})}function m(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},5785:function(e,n,t){t.d(n,{A:()=>r});var s=t(4848);t(6540);var i=t(3706);function r({toc:e,minHeadingLevel:n,maxHeadingLevel:t}){return(0,s.jsx)("div",{className:"tableOfContentsInline_prmo",children:(0,s.jsx)(i.A,{toc:e,minHeadingLevel:n,maxHeadingLevel:t,className:"table-of-contents",linkClassName:null})})}},3706:function(e,n,t){t.d(n,{A:()=>c});var s=t(4848),i=t(6540),r=t(8390);function l(e){let n=e.getBoundingClientRect();return n.top===n.bottom?l(e.parentNode):n}var o=t(7478);let a=i.memo(function e({toc:n,className:t,linkClassName:i,isChild:r}){return n.length?(0,s.jsx)("ul",{className:r?void 0:t,children:n.map(n=>(0,s.jsxs)("li",{children:[(0,s.jsx)(o.A,{to:`#${n.id}`,className:i??void 0,dangerouslySetInnerHTML:{__html:n.value}}),(0,s.jsx)(e,{isChild:!0,toc:n.children,className:t,linkClassName:i})]},n.id))}):null});function c({toc:e,className:n="table-of-contents table-of-contents__left-border",linkClassName:t="table-of-contents__link",linkActiveClassName:o,minHeadingLevel:c,maxHeadingLevel:d,...p}){var m;let h,u,g=(0,r.p)(),f=c??g.tableOfContents.minHeadingLevel,x=d??g.tableOfContents.maxHeadingLevel,j=function({toc:e,minHeadingLevel:n,maxHeadingLevel:t}){return(0,i.useMemo)(()=>{let s,i,r;return function e({toc:n,minHeadingLevel:t,maxHeadingLevel:s}){return n.flatMap(n=>{let i=e({toc:n.children,minHeadingLevel:t,maxHeadingLevel:s});return n.level>=t&&n.level<=s?[{...n,children:i}]:i})}({toc:(s=e.map(e=>({...e,parentIndex:-1,children:[]})),i=Array(7).fill(-1),s.forEach((e,n)=>{let t=i.slice(2,e.level);e.parentIndex=Math.max(...t),i[e.level]=n}),r=[],s.forEach(e=>{let{parentIndex:n,...t}=e;n>=0?s[n].children.push(t):r.push(t)}),r),minHeadingLevel:n,maxHeadingLevel:t})},[e,n,t])}({toc:e,minHeadingLevel:f,maxHeadingLevel:x});return m=(0,i.useMemo)(()=>{if(t&&o)return{linkClassName:t,linkActiveClassName:o,minHeadingLevel:f,maxHeadingLevel:x}},[t,o,f,x]),h=(0,i.useRef)(void 0),u=function(){let e=(0,i.useRef)(0),{navbar:{hideOnScroll:n}}=(0,r.p)();return(0,i.useEffect)(()=>{e.current=n?0:document.querySelector(".navbar").clientHeight},[n]),e}(),(0,i.useEffect)(()=>{if(!m)return()=>{};let{linkClassName:e,linkActiveClassName:n,minHeadingLevel:t,maxHeadingLevel:s}=m;function i(){let i=Array.from(document.getElementsByClassName(e)),r=function(e,{anchorTopOffset:n}){let t=e.find(e=>l(e).top>=n);if(t){var s;return(s=l(t)).top>0&&s.bottom<window.innerHeight/2?t:e[e.indexOf(t)-1]??null}return e[e.length-1]??null}(function({minHeadingLevel:e,maxHeadingLevel:n}){let t=[];for(let s=e;s<=n;s+=1)t.push(`h${s}.anchor`);return Array.from(document.querySelectorAll(t.join()))}({minHeadingLevel:t,maxHeadingLevel:s}),{anchorTopOffset:u.current}),o=i.find(e=>r&&r.id===decodeURIComponent(e.href.substring(e.href.indexOf("#")+1)));i.forEach(e=>{e===o?(h.current&&h.current!==e&&h.current.classList.remove(n),e.classList.add(n),h.current=e):e.classList.remove(n)})}return document.addEventListener("scroll",i),document.addEventListener("resize",i),i(),()=>{document.removeEventListener("scroll",i),document.removeEventListener("resize",i)}},[m,u]),(0,s.jsx)(a,{toc:j,className:n,linkClassName:t,...p})}},4429:function(e,n,t){t.d(n,{R:()=>l,x:()=>o});var s=t(6540);let i={},r=s.createContext(i);function l(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);